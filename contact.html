<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Nowy kontakt – SuperObozy</title>
  <link rel="stylesheet" href="./styles.css?v=7" />
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    /* Drobne dodatki UI tylko dla tej strony */
    .subtle{color:var(--muted);font-size:.9rem}
    .kpi{display:flex;gap:10px;flex-wrap:wrap}
    .kpi .card{padding:12px 14px}
    .score{font-size:1.6rem;font-weight:700}
    .chips{display:flex;gap:8px;flex-wrap:wrap}
    .chip{border:1px solid var(--br);border-radius:999px;padding:6px 10px;cursor:pointer}
    .chip.active{background:#e7f8f0;border-color:#b6e5cc}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    @media (max-width:820px){.row{grid-template-columns:1fr}}
    .danger{color:#b91c1c}
    .ok{color:#065f46}
    .mono{font-family:ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace}
    dialog{border:1px solid var(--br);border-radius:14px;padding:0;max-width:760px;width:95%}
    dialog header{padding:14px 16px;border-bottom:1px dashed var(--br)}
    dialog .body{padding:16px}
    dialog .footer{display:flex;justify-content:flex-end;gap:8px;padding:14px 16px;border-top:1px dashed var(--br)}
  </style>
</head>
<body>
  <header class="container">
    <h1>👤 Nowy kontakt</h1>
    <p class="muted">Szybkie zapisy, kontrola duplikatów, automatyczny follow-up i gotowe szablony wiadomości.</p>
    <nav class="mt">
      <a class="btn" href="./index.html">← Powrót</a>
      <a class="btn" href="./leads.html">📋 Lista kontaktów</a>
    </nav>
  </header>

  <main class="container mt">
    <section class="kpi">
      <div class="card">
        <div class="subtle">Lead score</div>
        <div class="score" id="lead-score">0</div>
      </div>
      <div class="card">
        <div class="subtle">Duplikaty</div>
        <div id="dup-info" class="mono">—</div>
      </div>
      <div class="card">
        <div class="subtle">Follow-up</div>
        <div id="fu-info" class="mono">za 3 dni</div>
      </div>
    </section>

    <section class="card mt">
      <form id="contact-form" class="grid">
        <label>Źródło
          <select name="source" id="source">
            <option>Telefon</option><option>E-mail</option>
            <option selected>Formularz www</option><option>Facebook</option>
            <option>Instagram</option><option>Inne</option>
          </select>
        </label>
        <label>Opiekun
          <select name="owner" id="owner">
            <option>Piotr</option><option>Anna</option><option>Kasia</option>
          </select>
        </label>

        <label>Klub / Szkoła <input name="club" id="club" placeholder="np. UKS Orlik" required /></label>
        <label>Osoba <input name="person" id="person" placeholder="np. Anna Kowalska" /></label>

        <label>Telefon <input name="phone" id="phone" placeholder="+48 600 700 800" /></label>
        <label>E-mail <input name="email" id="email" type="email" placeholder="kontakt@klub.pl" /></label>

        <label>Dyscyplina <input name="discipline" id="discipline" placeholder="np. piłka nożna / judo" /></label>
        <label>Uczestników <input name="participants" id="participants" type="number" min="1" placeholder="np. 45" /></label>

        <label>Zaplecze <input name="facilities" id="facilities" placeholder="np. hala, boisko" /></label>
        <label>Termin (okno) <input name="date_window" id="date_window" placeholder="np. 15–28 lipca" /></label>

        <label style="grid-column:1/-1">Lokalizacja preferowana
          <input name="pref_location" id="pref_location" placeholder="np. zachodniopomorskie / morze" />
        </label>
      </form>

      <div class="mt">
        <strong>Zainteresowany campami:</strong>
        <div class="chips" id="camps">
          <div class="chip" data-v="Jastrowie">Jastrowie</div>
          <div class="chip" data-v="Lipka">Lipka</div>
          <div class="chip" data-v="Dąbki">Dąbki</div>
          <div class="chip" data-v="Pobierowo">Pobierowo</div>
          <div class="chip" data-v="Rewal">Rewal</div>
        </div>
      </div>

      <div class="row mt">
        <label>Status
          <select id="status">
            <option value="nowy" selected>Nowy</option>
            <option value="w_trakcie">W trakcie</option>
            <option value="oferta_wyslana">Oferta wysłana</option>
            <option value="umowa">Umowa</option>
            <option value="utracony">Utracony</option>
          </select>
        </label>
        <label>Priorytet
          <select id="priority">
            <option>Niski</option><option selected>Średni</option><option>Wysoki</option>
          </select>
        </label>
      </div>

      <form class="grid mt" id="contact-meta">
        <label style="grid-column:1/-1">Notatki
          <textarea name="notes" id="notes" rows="4" placeholder="Dodatkowe informacje…"></textarea>
        </label>
        <label>Follow-up
          <select name="follow_up" id="follow_up">
            <option value="1">jutro</option><option value="3" selected>za 3 dni</option>
            <option value="7">za tydzień</option><option value="14">za 2 tygodnie</option>
          </select>
        </label>
        <label>Zgody (RODO)
          <select id="consent">
            <option value="brak" selected>Brak</option>
            <option value="marketing">Marketing</option>
            <option value="kontakt">Kontakt zwrotny</option>
            <option value="wszystkie">Wszystkie</option>
          </select>
        </label>
      </form>

      <div class="toolbar mt">
        <button class="btn" id="save-only">💾 Zapisz kontakt</button>
        <button class="btn btn-green" id="save-and-wa">🟩💬 Zapisz + WhatsApp</button>
        <button class="btn" id="templates">📄 Szablony wiadomości</button>
        <button class="btn btn-red" id="reset">🧹 Wyczyść</button>
      </div>

      <p class="small muted mt">Wskazówka: jeśli <code>config.js</code> jest puste, zapis idzie w trybie DEMO do <span class="mono">localStorage</span> (nie do bazy).</p>
    </section>

    <section class="card mt">
      <h3>⚡ Szybkie wiadomości</h3>
      <div class="toolbar mt">
        <button class="btn" id="btn-sms">📱 Kopiuj SMS</button>
        <button class="btn" id="btn-email">✉️ Otwórz e-mail</button>
        <button class="btn" id="btn-wa">🟩 Otwórz WhatsApp</button>
      </div>
      <p class="subtle mt">Teksty bazują na Twoich wzorcach. Uzupełnią się danymi z formularza.</p>
      <pre id="preview" class="mono" style="white-space:pre-wrap;background:#f8fafc;border:1px dashed var(--br);border-radius:10px;padding:12px;margin-top:10px"></pre>
    </section>
  </main>

  <!-- Modal: Szablony -->
  <dialog id="dlg">
    <header><strong style="padding-left:6px">📄 Szablony wiadomości</strong></header>
    <div class="body">
      <p class="small muted">Możesz edytować i zapisać jako domyślne (localStorage).</p>

      <label>SMS / Messenger
        <textarea id="tpl-sms" rows="3">Dziękuję za kontakt! Proszę o liczbę osób, dyscyplinę i termin przyjazdu, żeby przygotować zaplecze sportowe i bazę noclegowo-żywieniową. Pozdrawiam, Piotr – SuperObozy.pl</textarea>
      </label>

      <div class="mt"></div>

      <label>E-mail (temat)
        <input id="tpl-mail-subj" value="Wstępna oferta obozu – SuperObozy.pl" />
      </label>
      <label>E-mail (treść)
        <textarea id="tpl-mail-body" rows="8">Dzień dobry {PERSON},

dziękuję za kontakt w sprawie obozu dla {CLUB}. Żeby dobrze dobrać obiekt i zaplecze, proszę o:
• liczbę uczestników,
• dyscyplinę / profil,
• orientacyjny termin.

Nasze ośrodki mają opinię PSP, halę/boiska w pobliżu i pełne wyżywienie. W razie potrzeby możemy zorganizować Mszę na miejscu.

Pozdrawiam
Piotr Gołąb
SuperObozy.pl
tel. 604 936 806
        </textarea>
      </label>
    </div>
    <div class="footer">
      <button class="btn" id="dlg-cancel">Anuluj</button>
      <button class="btn btn-green" id="dlg-save">Zapisz szablony</button>
    </div>
  </dialog>

  <script src="./config.js"></script>
  <script src="./app.js" defer></script>
  <button class="btn btn-blue"  id="save-only"    data-action="save-only">💾 Zapisz nowy kontakt</button>
<button class="btn btn-green" id="save-and-wa"  data-action="save-and-wa">💬 Zapisz i otwórz WhatsApp</button>

<button class="btn"           id="templates"    data-action="templates">📄 Szablony wiadomości</button>
<button class="btn btn-red"   id="reset"        data-action="reset">🧹 Wyczyść</button>

</body>
</html>
<button class="btn btn-blue"  id="save-only"    data-action="save-only">💾 Zapisz nowy kontakt</button>
<button class="btn btn-green" id="save-and-wa"  data-action="save-and-wa">💬 Zapisz i otwórz WhatsApp</button>

<button class="btn"           id="templates"    data-action="templates">📄 Szablony wiadomości</button>
<button class="btn btn-red"   id="reset"        data-action="reset">🧹 Wyczyść</button>

